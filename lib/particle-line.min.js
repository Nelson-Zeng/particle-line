!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self).particleLine=i()}(this,function(){"use strict";var r=function(){function i(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x=t,this.y=i}return i.prototype.plus=function(t){return new i(this.x+t.x,this.y+t.y)},i.prototype.minus=function(t){return new i(this.x-t.x,this.y-t.y)},i.prototype.times=function(t){return new i(this.x*t,this.y*t)},i.prototype.abs=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i}(),o=function(){function t(t){this.center=t}return t.prototype.calcForce=function(t){var i=t.minus(this.center);return 0<=i.abs()&&i.abs()<200?i=i.times(-1/8e3):(i.x=0,i.y=0),i},t.prototype.calcDrag=function(t){var i=t.abs(),e=new r(t.x,t.y);return.5<i?e=e.times(-.001):(e.x=0,e.y=0),e},t}(),s=function(){function t(t){this.r=5,this.color="#3463B3",this.pos=t.pos,this.v=t.v,t.r&&(this.r=t.r),t.color&&(this.color=t.color)}return t.prototype.update=function(t){void 0===t&&(t=new r(0,0)),this.v=this.v.plus(t),this.pos=this.pos.plus(this.v)},t.prototype.calcAcceleration=function(t){var i=new o(t),e=i.calcForce(this.pos),r=i.calcDrag(this.v);return console.log(e),e.plus(r)},t.prototype.draw=function(t){t.beginPath(),t.arc(this.pos.x,this.pos.y,this.r,0,2*Math.PI,!0),t.closePath(),t.fillStyle=this.color,t.fill()},t.prototype.connection=function(t,i,e){t.beginPath(),t.moveTo(this.pos.x,this.pos.y),t.lineTo(i.x,i.y),t.lineWidth=e,t.strokeStyle=this.color,t.stroke()},t}();return function(){function t(t,i,e){void 0===t&&(t="#2D3553"),void 0===i&&(i="#3463B3"),void 0===e&&(e=null),this.width=300,this.height=300,this.surplus=0,this.particleNum=100,this.particleArr=[],this.particleMouse=null;var r=document.querySelector("body");this.background=t,this.color=i,this.width=window.innerWidth,this.height=window.innerHeight;var o=document.createElement("canvas");o.innerText="您的浏览器不支持 Canvas!",o.width=this.width,o.height=this.height,null===e&&(e=r.childNodes[0]),r.insertBefore(o,e),this.ctx=o.getContext("2d"),this.particleNum=this.getParticleNum(this.width,this.height),this.mousemove(o),this.mouseover(o),this.mouseout(o),this.animation()}return t.prototype.createParticle=function(){var t=this.particleArr.length;if(!(t>=this.particleNum))for(var i=t;i<this.particleNum;i++){var e=new s({pos:new r(this.randomRange(5,this.width-5),this.randomRange(5,this.height-5)),v:new r(this.randomRange(-1,1,!0,!1),this.randomRange(-1,1,!0,!1)),r:5,color:"rgb("+this.randomRange(0,255,!1)+","+this.randomRange(0,255,!1)+","+this.randomRange(0,255,!1)+")"});this.particleArr.push(e),this.surplus++}},t.prototype.draw=function(){var t,i=this.ctx;this.createParticle(),i.clearRect(0,0,this.width,this.height),i.fillStyle=this.background,i.fillRect(0,0,this.width,this.height);for(var e=0;e<this.surplus;e++){var r=this.particleArr[e];if(r.draw(i),r.update(),r.pos.x<=-5||r.pos.x>=this.width+5||r.pos.y<=-5||r.pos.y>=this.height+5)t=[this.particleArr[this.surplus-1],this.particleArr[e]],this.particleArr[e]=t[0],this.particleArr[this.surplus-1]=t[1],this.surplus--;else for(var o=e+1;o<this.surplus;o++){var s=this.particleArr[o].pos;(h=r.pos.minus(s).abs())<80&&r.connection(i,s,(80-h)/80*2)}}if(null!==this.particleMouse){this.particleMouse.draw(i);var n=this.particleMouse;for(e=0;e<this.particleNum;e++){var h,a=this.particleArr[e];if((h=n.pos.minus(a.pos).abs())<80&&this.particleMouse.connection(i,a.pos,(80-h)/80*2),h<200){var u=a.calcAcceleration(n.pos);a.update(u)}}}this.particleArr.splice(this.surplus)},t.prototype.animation=function(){var t=this;this.draw(),requestAnimationFrame(function(){return t.animation()})},t.prototype.randomRange=function(t,i,e,r){if(void 0===e&&(e=!0),void 0===r&&(r=!0),i<=t)throw"范围出错。";var o=t+Math.random()*(i-t);return o=e?Math.floor(100*o)/100:Math.floor(o),r||0!==o||(o=this.randomRange(t,i,e,r)),o},t.prototype.getParticleNum=function(t,i){return Math.floor(t/50)*Math.floor(i/100)},t.prototype.mouseover=function(t){var i=this;return t.addEventListener("mouseover",function(t){i.particleMouse=new s({pos:new r(t.clientX,t.clientY),v:new r(0,0)})})},t.prototype.mousemove=function(t){var i=this;return t.addEventListener("mousemove",function(t){null!==i.particleMouse&&(i.particleMouse.pos.x=t.clientX,i.particleMouse.pos.y=t.clientY)})},t.prototype.mouseout=function(t){var i=this;return t.addEventListener("mouseout",function(){i.particleMouse=null})},t}()});
